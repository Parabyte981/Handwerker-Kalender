<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handwerker Kalender Pro+</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@0.378.0/dist/umd/lucide-react.js"></script>
    <!-- Hinweis: Für Produktion sollte Tailwind CSS via PostCSS kompiliert werden -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <style>
        :root { --ls-primary-color: #3b82f6; --ls-secondary-color: #10b981; }
        .dark { --ls-primary-color: #60a5fa; --ls-secondary-color: #34d399; }
        body { font-family: 'Inter', sans-serif; margin: 0; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; }
        .calendar-day { position: relative; }
        .modal { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-overlay { position: absolute; inset: 0; background-color: rgba(0,0,0,0.5); }
        .modal-content { position: relative; z-index: 1001; max-height: 90vh; overflow-y: auto; }
        .sidebar-link.active { background-color: var(--ls-primary-color); color: white; }
        .sidebar-link.active svg { color: white; }
        .dark .sidebar-link.active { background-color: var(--ls-primary-color); }

        @media print {
            body { font-size: 9pt; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            .print-hidden { display: none !important; }
            .print-visible { display: block !important; }
            .print-text-sm { font-size: 0.8rem; }
            .print-p-0 { padding: 0 !important; }
            .print-m-0 { margin: 0 !important; }
            .print-w-full { width: 100% !important; }
            .print-bg-white { background-color: white !important; }
            .print-text-black { color: black !important; }
            .print-border { border: 1px solid #e5e7eb !important; }
            .modal, .sidebar { display: none !important; }
            main { margin-left: 0 !important; width: 100% !important; padding:0 !important; }
            .calendar-grid { grid-template-columns: repeat(7, minmax(0,1fr)); gap: 0; border: 1px solid #ccc; }
            .calendar-day { min-height: auto; border: 1px solid #ccc; padding: 2px; }
            .appointment-print { font-size: 0.65em; padding: 1px; margin-bottom: 1px; background-color: #f3f4f6 !important; color: #1f2937 !important; border: 1px solid #d1d5db; }
            /* Dark mode anpassungen für Druck entfernen */
            .dark body, .dark .calendar-day, .dark .modal-content, .dark .bg-gray-800, .dark .bg-gray-900, .dark .text-white, .dark .text-gray-100 {
                background-color: white !important; color: black !important; border-color: #e5e7eb !important;
            }
        }
    </style>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <div id="root"></div>
    <script type="text/babel">
// === Storage Key ===
const APP_STORAGE_KEY = 'handwerkerKalenderProPlusData_v1.2';

// === Icons (dynamisch geladen via UMD) ===
const { Calendar, ChevronLeft, ChevronRight, Clock, Plus, Edit2, Trash2, Save, X, AlertTriangle, Moon, Sun, Printer, User, Users, Info, Briefcase, Phone, Mail, MapPin, Settings, LayoutDashboard, FileText, DollarSign, Menu, LogOut, Search, Filter, Columns, Maximize, Minimize, ExternalLink } = lucideReact;

// === Initial Data & Settings ===
const initialData = {
    customers: [
        { id: 'c1', name: 'Max Mustermann', firma: 'Muster GmbH', strasseHnr: 'Musterweg 1', plz: '12345', stadt: 'Musterstadt', telefon: '0123-4567890', email: 'max@muster.de', kundenNr: 'K2024001' },
        { id: 'c2', name: 'Erika Mustermann', strasseHnr: 'Beispielallee 2a', plz: '54321', stadt: 'Beispielhausen', telefon: '0987-6543210', email: 'erika@beispiel.com', kundenNr: 'K2024002' },
    ],
    appointments: [
        { id: 'a1', customerId: 'c1', date: '2024-07-20', time: '10:00', task: 'Heizungswartung komplett', duration: 2.5, isRecurring: false, status: 'geplant', notes: 'Kunde wünscht Anruf 30 Min. vorher.', mitarbeiter: ['M1'], material: [{name: 'Dichtungssatz', menge:1}] },
        { id: 'a2', customerId: 'c2', date: '2024-07-22', time: '14:00', task: 'Sanitärinstallation Bad', duration: 4, isRecurring: false, status: 'bestätigt', notes: 'Neubau, alle Anschlüsse vorbereitet.', mitarbeiter: ['M1', 'M2'], material: [{name: 'Waschbecken V&B', menge:1}, {name: 'Armatur Grohe', menge:1}] },
    ],
    invoices: [
        { id: 'inv1', invoiceNr: 'RE2024001', customerId: 'c1', appointmentIds: ['a1'], date: '2024-07-21', totalNet: 250.00, taxRate: 0.19, totalGross: 297.50, status: 'bezahlt', items: [{ desc: 'Heizungswartungspauschale', menge: 1, preis: 200 }, { desc: 'Dichtungssatz', menge: 1, preis: 50 }] },
    ],
    mitarbeiter: [
        { id: 'M1', name: 'Peter Handwerker' },
        { id: 'M2', name: 'Anna Fleissig' },
    ],
    settings: {
        firmaName: "Meine Handwerksfirma GmbH",
        firmaStrasseHnr: "Werkstattweg 12",
        firmaPlzStadt: "12345 Handwerksstadt",
        firmaTelefon: "0123/456789",
        firmaEmail: "info@meinefirma.de",
        firmaWeb: "www.meinefirma.de",
        firmaSteuerNr: "123/456/7890",
        firmaUStId: "DE123456789",
        bankName: "Handwerkerbank",
        iban: "DE00123456789012345678",
        bic: "HANDDEHHXXX",
        darkMode: false,
        wochenstart: 1, // 0 für Sonntag, 1 für Montag
        standardAnsicht: "month",
        invoicePrefix: "RE",
        nextInvoiceNumber: 2,
        defaultTaxRate: 0.19,
    }
};

// === German Localization ===
const germanMonths = ["Januar", "Februar", "März", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"];
const germanDays = ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"]; // Wird ggf. angepasst durch wochenstart

// === Utility Functions ===
const getCalendarWeek = (date, startDayOfWeek = 1) => { /* ... (ISO 8601 week number) ... */
    const target = new Date(date.valueOf());
    const dayNr = (date.getUTCDay() + 7 - startDayOfWeek) % 7;
    target.setDate(target.getDate() - dayNr + 3);
    const firstThursday = new Date(target.getFullYear(), 0, 4);
    target.setMonth(0, 1 + ((target.getTime() - firstThursday.getTime()) / 86400000 - 3 + (firstThursday.getDay() + 7 - startDayOfWeek) % 7) / 7 * 7);
    return Math.ceil((target.getTime() - new Date(target.getFullYear(), 0, 1).getTime()) / 86400000 / 7) +1;
};

const formatDate = (date, options = { day: '2-digit', month: '2-digit', year: 'numeric' }) => new Date(date).toLocaleDateString('de-DE', options);
const formatCurrency = (amount) => new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(amount);

// === HTML für Rechnung (Beispiel) ===
const generateInvoiceHTML = (invoice, customer, settings, appointmentsDetails) => {
    // ... (komplette HTML Struktur für die Rechnung)
    const appointmentTasks = appointmentsDetails.map(a => a.task).join(', ') || 'Keine Termine zugeordnet';
    return `
        <!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>Rechnung ${invoice.invoiceNr}</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 0; padding: 0; color: #333; font-size: 10pt; }
            .container { width: 800px; margin: 20px auto; padding: 20px; border: 1px solid #eee; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
            header, footer { text-align: center; margin-bottom: 20px; }
            header img { max-width: 150px; margin-bottom: 10px;}
            h1 { color: var(--ls-primary-color, #3b82f6); border-bottom: 2px solid var(--ls-primary-color, #3b82f6); padding-bottom: 5px; }
            .firma-info, .kunde-info, .rechnung-details { margin-bottom: 20px; font-size: 0.9em; }
            .firma-info p, .kunde-info p, .rechnung-details p { margin: 2px 0; }
            .items-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
            .items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            .items-table th { background-color: #f8f8f8; }
            .totals { float: right; width: 300px; margin-top: 20px; }
            .totals table { width: 100%; }
            .totals td { padding: 5px; }
            .text-right { text-align: right; }
            .small-text { font-size: 0.8em; color: #777; }
            .signature-area { margin-top: 50px; border-top: 1px solid #eee; padding-top: 20px; }
            .flex-container { display: flex; justify-content: space-between; }
        </style>
        </head><body>
        <div class="container">
            <header>
                <h1>Rechnung</h1>
                <div class="flex-container">
                    <div class="firma-info" style="text-align:left;">
                        <p><strong>${settings.firmaName}</strong></p>
                        <p>${settings.firmaStrasseHnr}</p>
                        <p>${settings.firmaPlzStadt}</p>
                        <p>Tel: ${settings.firmaTelefon} | Email: ${settings.firmaEmail}</p>
                    </div>
                    <div class="rechnung-details" style="text-align:right;">
                        <p><strong>Rechnungsnr.:</strong> ${invoice.invoiceNr}</p>
                        <p><strong>Datum:</strong> ${formatDate(invoice.date)}</p>
                        <p><strong>Kundennr.:</strong> ${customer.kundenNr || customer.id}</p>
                    </div>
                </div>
            </header>
            <section class="kunde-info">
                <p>An:</p>
                <p><strong>${customer.name}</strong></p>
                {customer.firma && <p><strong>${customer.firma}</strong></p>}
                <p>${customer.strasseHnr}</p>
                <p>${customer.plz} ${customer.stadt}</p>
            </section>
            <section>
                <p style="margin-bottom: 10px;">Sehr geehrte/r Herr/Frau ${customer.name.split(' ').pop()},</p>
                <p style="margin-bottom: 10px;">hiermit stellen wir Ihnen folgende Leistungen in Rechnung:</p>
                <p style="margin-bottom: 10px;"><strong>Projekt/Termin:</strong> ${appointmentTasks}</p>
            </section>
            <section class="items-table">
                <table>
                    <thead><tr><th>Pos.</th><th>Beschreibung</th><th>Menge</th><th>Einzelpreis</th><th>Gesamtpreis</th></tr></thead>
                    <tbody>
                        ${invoice.items.map((item, index) => `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${item.desc}</td>
                                <td>${item.menge}</td>
                                <td class="text-right">${formatCurrency(item.preis)}</td>
                                <td class="text-right">${formatCurrency(item.menge * item.preis)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </section>
            <section class="totals">
                <table>
                    <tr><td>Zwischensumme Netto:</td><td class="text-right">${formatCurrency(invoice.totalNet)}</td></tr>
                    <tr><td>Umsatzsteuer (${(invoice.taxRate * 100).toFixed(0)}%):</td><td class="text-right">${formatCurrency(invoice.totalGross - invoice.totalNet)}</td></tr>
                    <tr><td><strong>Gesamtbetrag Brutto:</strong></td><td class="text-right"><strong>${formatCurrency(invoice.totalGross)}</strong></td></tr>
                </table>
            </section>
            <section class="zahlungsinfo" style="margin-top: 30px;">
                <p>Zahlungsziel: 14 Tage ohne Abzug.</p>
                <p>Bitte überweisen Sie den Betrag auf folgendes Konto:</p>
                <p><strong>Bank:</strong> ${settings.bankName}<br/>
                   <strong>IBAN:</strong> ${settings.iban}<br/>
                   <strong>BIC:</strong> ${settings.bic}</p>
            </section>
            <footer class="small-text" style="margin-top: 50px; border-top: 1px solid #eee; padding-top: 10px;">
                <p>${settings.firmaName} | ${settings.firmaStrasseHnr}, ${settings.firmaPlzStadt}</p>
                <p>Tel: ${settings.firmaTelefon} | Email: ${settings.firmaEmail} | Web: ${settings.firmaWeb}</p>
                <p>Steuernummer: ${settings.firmaSteuerNr} | USt-IdNr.: ${settings.firmaUStId}</p>
            </footer>
        </div></body></html>
    `;
};


// === Main App Component: HandwerkerKalenderPro ===
const HandwerkerKalenderPro = () => {
    const [data, setData] = useState(() => {
        const savedData = localStorage.getItem(APP_STORAGE_KEY);
        return savedData ? JSON.parse(savedData) : initialData;
    });

    const { customers, appointments, invoices, mitarbeiter, settings } = data;

    // Derived/Calculated states
    const [currentDate, setCurrentDate] = useState(new Date());
    const [viewMode, setViewMode] = useState(settings.standardAnsicht || 'month'); // 'dashboard', 'month', 'week', 'day', 'customers', 'invoices', 'settings'
    const [sidebarOpen, setSidebarOpen] = useState(false);
    const [activeView, setActiveView] = useState(settings.standardAnsicht || 'month');


    // UI States
    const [modal, setModal] = useState({ type: null, data: null }); // { type: 'appointment', data: appointment } or { type: 'customer', data: customer } etc.
    const [searchTerm, setSearchTerm] = useState(''); // Universal search term for current view

    // Update localStorage whenever data changes
    useEffect(() => {
        localStorage.setItem(APP_STORAGE_KEY, JSON.stringify(data));
    }, [data]);

    useEffect(() => {
        document.documentElement.classList.toggle('dark', settings.darkMode);
        document.documentElement.style.setProperty('--ls-primary-color', settings.darkMode ? '#60a5fa' : '#3b82f6'); // Example: Tailwind blue-500
    }, [settings.darkMode]);

    const updateSettings = (newSettings) => {
        setData(prev => ({ ...prev, settings: { ...prev.settings, ...newSettings }}));
    };

    // CRUD Operations (simplified examples)
    const saveAppointment = (appData) => {
        setData(prev => ({ ...prev, appointments: editingAppointment
            ? prev.appointments.map(a => a.id === editingAppointment.id ? { ...editingAppointment, ...appData, customerName: customers.find(c=>c.id === appData.customerId)?.name } : a)
            : [...prev.appointments, { ...appData, id: 'a' + Date.now(), customerName: customers.find(c=>c.id === appData.customerId)?.name }]
        }));
        setModal({type: null, data: null});
    };
    // ... other CRUD operations for customers, invoices etc.

    // Navigation Handlers
    const handlePrevDate = () => setCurrentDate(prev => { /* ... */ });
    const handleNextDate = () => setCurrentDate(prev => { /* ... */ });
    const handleToday = () => { setCurrentDate(new Date()); setActiveView('day'); };

    // Dynamic view rendering
    const CurrentViewComponent = ({ view, props }) => {
        switch (view) {
            case 'dashboard': return <DashboardView stats={getDashboardStats()} />;
            case 'month':
            case 'week':
            case 'day':
                return <CalendarView viewMode={view} currentDate={currentDate} appointments={appointments} customers={customers} onDateClick={(date) => { setCurrentDate(date); setActiveView('day');}} onEventClick={(app) => setModal({type: 'appointment', data: app})} settings={settings} />;
            case 'customers': return <CustomerListView customers={customers} onSelectCustomer={(c) => setModal({type: 'customerView', data: c})} onEditCustomer={(c) => setModal({type: 'customerEdit', data: c})} searchTerm={searchTerm} />;
            case 'invoices': return <InvoiceListView invoices={invoices} customers={customers} onSelectInvoice={(inv) => setModal({type: 'invoiceView', data: inv})} />;
            case 'settings': return <SettingsView settings={settings} onSave={updateSettings} />;
            default: return <DashboardView stats={getDashboardStats()} />;
        }
    };

    // Calculate some dashboard stats (example)
    const getDashboardStats = () => ({
        totalAppointments: appointments.length,
        upcomingAppointments: appointments.filter(a => new Date(a.date) >= new Date() && a.status !== 'abgeschlossen').length,
        totalCustomers: customers.length,
        openInvoices: invoices.filter(inv => inv.status === 'offen').length,
    });


    // Sidebar and Main Layout
    return (
        <div className="flex h-screen bg-gray-100 dark:bg-gray-900">
            {/* Sidebar */}
            <aside className={`print-hidden fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-800 shadow-lg transform ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 transition-transform duration-200 ease-in-out`}>
                <div className="p-4 flex items-center justify-between border-b dark:border-gray-700">
                    <h1 className="text-2xl font-bold text-[var(--ls-primary-color)] flex items-center"><Calendar size={28} className="mr-2"/>Pro+</h1>
                    <button onClick={() => setSidebarOpen(false)} className="md:hidden text-gray-600 dark:text-gray-300 hover:text-[var(--ls-primary-color)]">
                        <X size={24} />
                    </button>
                </div>
                <nav className="mt-4 px-2 space-y-1">
                    {[
                        { view: 'dashboard', label: 'Dashboard', icon: LayoutDashboard },
                        { view: 'month', label: 'Kalender', icon: Calendar },
                        { view: 'customers', label: 'Kunden', icon: Users },
                        { view: 'invoices', label: 'Rechnungen', icon: FileText },
                        { view: 'settings', label: 'Einstellungen', icon: Settings },
                    ].map(item => (
                        <a
                            key={item.view}
                            href="#"
                            onClick={(e) => { e.preventDefault(); setActiveView(item.view); setSidebarOpen(false); }}
                            className={`sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-[var(--ls-primary-color)] dark:hover:text-[var(--ls-primary-color)] ${activeView === item.view ? 'active' : ''}`}
                        >
                            <item.icon size={20} className="mr-3 text-gray-500 dark:text-gray-400 group-hover:text-[var(--ls-primary-color)]" />
                            {item.label}
                        </a>
                    ))}
                </nav>
                <div className="absolute bottom-0 left-0 w-full p-4 border-t dark:border-gray-700">
                    <button className="w-full flex items-center px-3 py-2.5 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <LogOut size={20} className="mr-3 text-gray-500 dark:text-gray-400"/> Abmelden
                    </button>
                </div>
            </aside>

            {/* Main content */}
            <div className="flex-1 flex flex-col overflow-hidden">
                <header className="print-hidden bg-white dark:bg-gray-800 shadow-sm border-b dark:border-gray-700">
                    <div className="container mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex items-center justify-between h-16">
                            <div className="flex items-center">
                                <button onClick={() => setSidebarOpen(true)} className="md:hidden text-gray-500 dark:text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 mr-2">
                                    <Menu size={24}/>
                                </button>
                                {activeView !== 'customers' && activeView !== 'settings' && activeView !== 'dashboard' && (
                                    <div className="hidden md:flex items-center space-x-1">
                                        <button onClick={handlePrevDate} className="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400"><ChevronLeft size={22}/></button>
                                        <span className="text-lg font-medium text-gray-800 dark:text-gray-200 w-60 text-center select-none">{formatDateRangeHeader(currentDate, activeView)}</span>
                                        <button onClick={handleNextDate} className="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400"><ChevronRight size={22}/></button>
                                        <button onClick={handleToday} className="ml-2 px-3 py-1.5 text-sm font-medium bg-[var(--ls-primary-color)] text-white rounded-md hover:opacity-90">Heute</button>
                                    </div>
                                )}
                                {(activeView === 'customers' || activeView === 'invoices') && (
                                    <div className="relative">
                                        <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <Search size={18} className="text-gray-400 dark:text-gray-500" />
                                        </div>
                                        <input
                                            type="text"
                                            placeholder={`${activeView === 'customers' ? 'Kunden' : 'Rechnungen'} suchen...`}
                                            value={searchTerm}
                                            onChange={e => setSearchTerm(e.target.value)}
                                            className="block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-[var(--ls-primary-color)] focus:border-[var(--ls-primary-color)] sm:text-sm"
                                        />
                                    </div>
                                )}
                            </div>
                            <div className="flex items-center space-x-3">
                               {/* Global Actions / User Menu could go here */}
                               <button onClick={() => window.print()} className="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400" title="Drucken">
                                   <Printer size={20}/>
                               </button>
                                <button onClick={() => updateSettings({darkMode: !settings.darkMode})} className="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400" title="Dark/Light Mode">
                                    {settings.darkMode ? <Sun size={20}/> : <Moon size={20}/>}
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
                <main className="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 dark:bg-gray-900 p-4 sm:p-6" id="main-content-area">
                    <CurrentViewComponent view={activeView} props={{ currentDate, settings, customers, appointments, invoices, mitarbeiter, /* pass other needed props */ }} />
                </main>
            </div>
            {/* Modals will be rendered here */}
            {modal.type === 'appointment' && <AppointmentModal isOpen={!!modal.type} onClose={() => setModal({type:null, data:null})} onSave={saveAppointment} existingAppointment={modal.data} customers={customers} darkMode={settings.darkMode} />}
            {/* ... other modals ... */}
        </div>
    );
};


// === Sub-Components (Stubs or Simplified) ===
const DashboardView = ({ stats }) => (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow hover:shadow-lg transition-shadow">
            <h3 className="text-lg font-medium text-gray-500 dark:text-gray-400">Termine Gesamt</h3>
            <p className="mt-1 text-3xl font-semibold text-gray-900 dark:text-white">{stats.totalAppointments}</p>
        </div>
         <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow hover:shadow-lg transition-shadow">
            <h3 className="text-lg font-medium text-gray-500 dark:text-gray-400">Anstehende Termine</h3>
            <p className="mt-1 text-3xl font-semibold text-gray-900 dark:text-white">{stats.upcomingAppointments}</p>
        </div>
        <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow hover:shadow-lg transition-shadow">
            <h3 className="text-lg font-medium text-gray-500 dark:text-gray-400">Kunden</h3>
            <p className="mt-1 text-3xl font-semibold text-gray-900 dark:text-white">{stats.totalCustomers}</p>
        </div>
        <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow hover:shadow-lg transition-shadow">
            <h3 className="text-lg font-medium text-gray-500 dark:text-gray-400">Offene Rechnungen</h3>
            <p className="mt-1 text-3xl font-semibold text-red-600 dark:text-red-400">{stats.openInvoices}</p>
        </div>
    </div>
);

const CalendarView = ({ viewMode, currentDate, appointments, customers, onDateClick, onEventClick, settings }) => {
    // Simplified: This would contain the complex grid/list rendering logic from the original App component
    // adapted for the specific viewMode (month, week, day)
    // For now, just a placeholder
    return <div className="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
        <h2 className="text-xl font-semibold mb-2">{viewMode.charAt(0).toUpperCase() + viewMode.slice(1)} Ansicht</h2>
        <p>Datum: {currentDate.toLocaleDateString('de-DE')}</p>
        <p>{appointments.length} Termine in dieser Periode (Platzhalter).</p>
        {/* Actual calendar rendering would go here */}
    </div>;
};

const CustomerListView = ({ customers, onSelectCustomer, onEditCustomer, searchTerm }) => {
    const filtered = customers.filter(c => c.name.toLowerCase().includes(searchTerm.toLowerCase()) || (c.firma && c.firma.toLowerCase().includes(searchTerm.toLowerCase())));
    return (
        <div className="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
            <ul className="divide-y divide-gray-200 dark:divide-gray-700">
                {filtered.map(customer => (
                    <li key={customer.id} className="py-3 flex justify-between items-center">
                        <div onClick={() => onSelectCustomer(customer)} className="cursor-pointer">
                            <p className="text-md font-medium text-[var(--ls-primary-color)]">{customer.name} {customer.firma && `(${customer.firma})`}</p>
                            <p className="text-sm text-gray-500 dark:text-gray-400">{customer.stadt}</p>
                        </div>
                        <button onClick={() => onEditCustomer(customer)} className="text-yellow-500 hover:text-yellow-700 p-1"><Edit2 size={18}/></button>
                    </li>
                ))}
            </ul>
        </div>
    );
};
const InvoiceListView = ({ invoices, customers, onSelectInvoice }) => { /* ... */ return <div>Rechnungsliste (Platzhalter)</div>; };

const SettingsView = ({ settings, onSave }) => {
    const [formData, setFormData] = useState(settings);
    useEffect(() => setFormData(settings), [settings]);
    const handleChange = (e) => setFormData({...formData, [e.target.name]: e.target.type === 'checkbox' ? e.target.checked : e.target.value });
    const handleSubmit = (e) => { e.preventDefault(); onSave(formData); alert("Einstellungen gespeichert!"); };

    return (
        <form onSubmit={handleSubmit} className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow space-y-6">
            <h2 className="text-2xl font-semibold border-b pb-3 dark:border-gray-700">Allgemeine Einstellungen</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div><label className="block text-sm font-medium">Firmenname</label><input type="text" name="firmaName" value={formData.firmaName} onChange={handleChange} className="mt-1 settings-input"/></div>
                {/* ... more settings fields like strasse, plz, etc. ... */}
                 <div><label className="block text-sm font-medium">Standard Ansicht</label>
                    <select name="standardAnsicht" value={formData.standardAnsicht} onChange={handleChange} className="mt-1 settings-input">
                        <option value="month">Monat</option><option value="week">Woche</option><option value="day">Tag</option><option value="dashboard">Dashboard</option>
                    </select>
                </div>
                <div className="flex items-center"><input type="checkbox" name="darkMode" checked={formData.darkMode} onChange={handleChange} className="h-4 w-4 text-[var(--ls-primary-color)] border-gray-300 rounded focus:ring-[var(--ls-primary-color)]"/><label className="ml-2 block text-sm">Dark Mode</label></div>
            </div>
            <div className="pt-6 border-t dark:border-gray-700"><button type="submit" className="px-4 py-2 bg-[var(--ls-primary-color)] text-white rounded-md hover:opacity-90 flex items-center"><Save size={18} className="mr-2"/>Einstellungen Speichern</button></div>
        </form>
    );
};

// Dummy AppointmentModal for now
const AppointmentModal = ({ isOpen, onClose, onSave, existingAppointment, customers, darkMode }) => {
    if (!isOpen) return null;
    return (
        <div className="modal"><div className={`modal-overlay`} onClick={onClose}></div>
            <div className={`modal-content bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-lg`}>
                <h3 className="text-lg font-medium mb-4">{existingAppointment ? 'Termin bearbeiten' : 'Neuer Termin'}</h3>
                <p>Terminmodal Platzhalter. Kunde: {customers.find(c=>c.id === existingAppointment?.customerId)?.name || 'Neu'}</p>
                <div className="mt-4 flex justify-end space-x-2">
                    <button onClick={onClose} className="px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md text-sm hover:bg-gray-50 dark:hover:bg-gray-700">Abbrechen</button>
                    <button onClick={() => onSave({})} className="px-3 py-1.5 bg-[var(--ls-primary-color)] text-white rounded-md text-sm hover:opacity-90">Speichern</button>
                </div>
            </div>
        </div>
    );
};


// Helper for Tailwind a JIT friendly class list, not strictly needed with CDN but good practice
const classNames = (...classes) => classes.filter(Boolean).join(' ');

// Mount the app
ReactDOM.render(React.createElement(HandwerkerKalenderPro), document.getElementById('root'));

    </script>
</body>
</html>
